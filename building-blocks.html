<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>3 Building Blocks | Introduction to mlr3</title>
  <meta name="description" content="3 Building Blocks | Introduction to mlr3">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="3 Building Blocks | Introduction to mlr3" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Building Blocks | Introduction to mlr3" />
  
  
  

<meta name="author" content="The mlr-org Team">


<meta name="date" content="2019-04-16">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="introduction.html">
<link rel="next" href="experiments.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="building-blocks.html"><a href="building-blocks.html"><i class="fa fa-check"></i><b>3</b> Building Blocks</a><ul>
<li class="chapter" data-level="3.1" data-path="building-blocks.html"><a href="building-blocks.html#tasks"><i class="fa fa-check"></i><b>3.1</b> Tasks</a><ul>
<li class="chapter" data-level="3.1.1" data-path="building-blocks.html"><a href="building-blocks.html#task-types"><i class="fa fa-check"></i><b>3.1.1</b> Task Types</a></li>
<li class="chapter" data-level="3.1.2" data-path="building-blocks.html"><a href="building-blocks.html#task-creation"><i class="fa fa-check"></i><b>3.1.2</b> Task Creation</a></li>
<li class="chapter" data-level="3.1.3" data-path="building-blocks.html"><a href="building-blocks.html#predefined-tasks"><i class="fa fa-check"></i><b>3.1.3</b> Predefined tasks</a></li>
<li class="chapter" data-level="3.1.4" data-path="building-blocks.html"><a href="building-blocks.html#task-api"><i class="fa fa-check"></i><b>3.1.4</b> Task API</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="building-blocks.html"><a href="building-blocks.html#learners"><i class="fa fa-check"></i><b>3.2</b> Learners</a><ul>
<li class="chapter" data-level="3.2.1" data-path="building-blocks.html"><a href="building-blocks.html#predefined-learners"><i class="fa fa-check"></i><b>3.2.1</b> Predefined Learners</a></li>
<li class="chapter" data-level="3.2.2" data-path="building-blocks.html"><a href="building-blocks.html#train-and-predict"><i class="fa fa-check"></i><b>3.2.2</b> Train and Predict</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="building-blocks.html"><a href="building-blocks.html#measures"><i class="fa fa-check"></i><b>3.3</b> Performance Measures</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="experiments.html"><a href="experiments.html"><i class="fa fa-check"></i><b>4</b> Experiments</a><ul>
<li class="chapter" data-level="4.1" data-path="experiments.html"><a href="experiments.html#task-and-learner-objects"><i class="fa fa-check"></i><b>4.1</b> Task and learner objects</a></li>
<li class="chapter" data-level="4.2" data-path="experiments.html"><a href="experiments.html#index-vector-for-traintest-splits"><i class="fa fa-check"></i><b>4.2</b> Index vector for train/test splits</a></li>
<li class="chapter" data-level="4.3" data-path="experiments.html"><a href="experiments.html#setting-up-an-experiment"><i class="fa fa-check"></i><b>4.3</b> Setting up an experiment</a></li>
<li class="chapter" data-level="4.4" data-path="experiments.html"><a href="experiments.html#training"><i class="fa fa-check"></i><b>4.4</b> Training</a></li>
<li class="chapter" data-level="4.5" data-path="experiments.html"><a href="experiments.html#predicting"><i class="fa fa-check"></i><b>4.5</b> Predicting</a><ul>
<li class="chapter" data-level="4.5.1" data-path="experiments.html"><a href="experiments.html#performance-assessment"><i class="fa fa-check"></i><b>4.5.1</b> Performance assessment</a></li>
<li class="chapter" data-level="4.5.2" data-path="experiments.html"><a href="experiments.html#chaining-methods"><i class="fa fa-check"></i><b>4.5.2</b> Chaining methods</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="resampling.html"><a href="resampling.html"><i class="fa fa-check"></i><b>5</b> Resampling</a><ul>
<li class="chapter" data-level="5.1" data-path="resampling.html"><a href="resampling.html#objects"><i class="fa fa-check"></i><b>5.1</b> Objects</a></li>
<li class="chapter" data-level="5.2" data-path="resampling.html"><a href="resampling.html#resampling-1"><i class="fa fa-check"></i><b>5.2</b> Resampling</a></li>
<li class="chapter" data-level="5.3" data-path="resampling.html"><a href="resampling.html#manual-instantiation"><i class="fa fa-check"></i><b>5.3</b> Manual instantiation</a></li>
<li class="chapter" data-level="5.4" data-path="resampling.html"><a href="resampling.html#custom-resampling"><i class="fa fa-check"></i><b>5.4</b> Custom resampling</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="benchmarking.html"><a href="benchmarking.html"><i class="fa fa-check"></i><b>6</b> Benchmarking</a><ul>
<li class="chapter" data-level="6.1" data-path="benchmarking.html"><a href="benchmarking.html#benchmarking-exhaustive-designs"><i class="fa fa-check"></i><b>6.1</b> Benchmarking Exhaustive Designs</a></li>
<li class="chapter" data-level="6.2" data-path="benchmarking.html"><a href="benchmarking.html#converting-specific-benchmark-objects-to-resample-objects"><i class="fa fa-check"></i><b>6.2</b> Converting specific benchmark objects to resample objects</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="error-handling.html"><a href="error-handling.html"><i class="fa fa-check"></i><b>7</b> Error Handling</a><ul>
<li class="chapter" data-level="7.1" data-path="error-handling.html"><a href="error-handling.html#setup"><i class="fa fa-check"></i><b>7.1</b> Setup</a></li>
<li class="chapter" data-level="7.2" data-path="error-handling.html"><a href="error-handling.html#no-error-handling"><i class="fa fa-check"></i><b>7.2</b> No error handling</a></li>
<li class="chapter" data-level="7.3" data-path="error-handling.html"><a href="error-handling.html#encapsulation"><i class="fa fa-check"></i><b>7.3</b> Encapsulation</a></li>
<li class="chapter" data-level="7.4" data-path="error-handling.html"><a href="error-handling.html#fallback-learners"><i class="fa fa-check"></i><b>7.4</b> Fallback learners</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="parallelization.html"><a href="parallelization.html"><i class="fa fa-check"></i><b>8</b> Parallelization</a><ul>
<li class="chapter" data-level="8.1" data-path="parallelization.html"><a href="parallelization.html#prerequisites-1"><i class="fa fa-check"></i><b>8.1</b> Prerequisites</a></li>
<li class="chapter" data-level="8.2" data-path="parallelization.html"><a href="parallelization.html#parallel-resampling"><i class="fa fa-check"></i><b>8.2</b> Parallel resampling</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to mlr3</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="building-blocks" class="section level1">
<h1><span class="header-section-number">3</span> Building Blocks</h1>
<div id="tasks" class="section level2">
<h2><span class="header-section-number">3.1</span> Tasks</h2>
<p>Learning tasks encapsulate the data set and additional meta information about a machine learning problem, for example the name of the target variable for supervised problems.</p>
<div id="task-types" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Task Types</h3>
<p>To manually create a task from a <a href="https://www.rdocumentation.org/packages/base/topics/data.frame"><code>data.frame()</code></a> or <a href="https://www.rdocumentation.org/packages/data.table/topics/data.table-package"><code>data.table()</code></a>, you must first determine the task type to select the respective constructor:</p>
<ul>
<li>Classification Task: Target column is labels (stored as <code>character()</code>/<code>factor()</code>) with only few distinct values.
<br><span class="math inline">\(\Rightarrow\)</span> <a href="https://mlr3.mlr-org.com/reference/TaskClassif.html"><code>TaskClassif</code></a></li>
<li>Regression Task: Target column is numeric (stored as <code>integer()</code>/<code>double()</code>).
<br><span class="math inline">\(\Rightarrow\)</span> <a href="https://mlr3.mlr-org.com/reference/TaskRegr.html"><code>TaskRegr</code></a></li>
<li>Survival Task: Target is the (right-censored) time to event.
<br><span class="math inline">\(\Rightarrow\)</span> <a href="https://mlr3survival.mlr-org.com/reference/TaskSurv.html"><code>TaskSurv</code></a> in add-on package <a href="https://mlr3surival.mlr-org.com">mlr3surival</a></li>
<li>Ordinal Regression Task: Target is ordinal.
<br><span class="math inline">\(\Rightarrow\)</span> <a href="https://mlr3ordinal.mlr-org.com/reference/TaskOrdinal.html"><code>TaskOrdinal</code></a> in add-on package <a href="https://mlr3ordinal.mlr-org.com">mlr3ordinal</a></li>
<li>Cluster Task: You don’t have a target but want to identify similarities in the feature space.
<br><span class="math inline">\(\Rightarrow\)</span> Not yet implemented</li>
</ul>
</div>
<div id="task-creation" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Task Creation</h3>
<p>Let’s assume we want to create a simple regression task using the <code>mtcars</code> data set from the package <code>datasets</code> to predict the column <code>"mpg"</code> (miles per gallon).
We only take the first two features here to keep the output in the following examples compact.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;mtcars&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;datasets&quot;</span>)
data =<span class="st"> </span>mtcars[, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]
<span class="kw">str</span>(data)</code></pre>
<pre><code>## &#39;data.frame&#39;:    32 obs. of  3 variables:
##  $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
##  $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...
##  $ disp: num  160 160 108 258 360 ...</code></pre>
<p>Next, we create the task by providing the following information:</p>
<ol style="list-style-type: decimal">
<li><code>id</code>: identifier for the task, used in plots and summaries.</li>
<li><code>backend</code>: here, we simply provide the <code>data.frame()</code> which is internally converted to a <a href="https://mlr3.mlr-org.com/reference/DataBackendDataTable.html"><code>DataBackendDataTable</code></a>.
For more fine-grain control over how the data is stored internally, we could also construct a <a href="https://mlr3.mlr-org.com/reference/DataBackend.html"><code>DataBackend</code></a> manually.</li>
<li><code>target</code>: Column name of the target column for the regression problem.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">task_mtcars =<span class="st"> </span>TaskRegr<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">&quot;cars&quot;</span>, <span class="dt">backend =</span> data, <span class="dt">target =</span> <span class="st">&quot;mpg&quot;</span>)
<span class="kw">print</span>(task_mtcars)</code></pre>
<pre><code>## &lt;TaskRegr:cars&gt; (32 x 3)
## Target: mpg
## Features (2):
## * dbl (2): cyl, disp
## 
## Public: backend, cbind(), clone(), col_info, col_roles,
##   data_formats, data(), droplevels(), feature_names,
##   feature_types, filter(), formula(), groups, hash, head(), id,
##   levels(), measures, missings(), ncol, nrow, properties, rbind(),
##   replace_features(), row_ids, row_roles, select(),
##   set_col_role(), set_row_role(), target_names, task_type,
##   truth(), weights</code></pre>
<p>The <code>print()</code> method gives a short summary of the task: It has 32 observations, 3 columns of which 2 columns are features.</p>
</div>
<div id="predefined-tasks" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Predefined tasks</h3>
<p><code>mlr3</code> ships with some predefined machine learning tasks.
These are stored in a <a href="https://mlr3.mlr-org.com/reference/Dictionary.html"><code>Dictionary</code></a>, which is a simple key-value store named <code>mlr3::mlr_tasks</code>.
We can obtain a summarizing overview of all stored tasks by converting the dictionary to a <code>data.table()</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.data.table</span>(mlr_tasks)</code></pre>
<pre><code>##       key task_type     measures nrow ncol lgl int dbl chr fct ord
## 1:     bh      regr     regr.mse  506   19   0   3  13   0   2   0
## 2:   iris   classif classif.mmce  150    5   0   0   4   0   0   0
## 3: mtcars      regr     regr.mse   32   11   0   0  10   0   0   0
## 4:   pima   classif classif.mmce  768    9   0   0   8   0   0   0
## 5:  sonar   classif classif.mmce  208   61   0   0  60   0   0   0
## 6:   spam   classif classif.mmce 4601   58   0   0  57   0   0   0
## 7:   wine   classif classif.mmce  178   14   0   2  11   0   0   0
## 8:    zoo   classif classif.mmce  101   17  15   1   0   0   0   0</code></pre>
<p>For illustration purposes, we now retrieve the popular <a href="https://en.wikipedia.org/wiki/Iris_flower_data_set">iris data set</a> from <code>mlr_tasks</code> as a classification task:</p>
<pre class="sourceCode r"><code class="sourceCode r">task_iris =<span class="st"> </span>mlr_tasks<span class="op">$</span><span class="kw">get</span>(<span class="st">&quot;iris&quot;</span>)
<span class="kw">print</span>(task_iris)</code></pre>
<pre><code>## &lt;TaskClassif:iris&gt; (150 x 5)
## Target: Species
## Features (4):
## * dbl (4): Petal.Length, Petal.Width, Sepal.Length, Sepal.Width
## 
## Public: backend, cbind(), class_n, class_names, clone(),
##   col_info, col_roles, data_formats, data(), droplevels(),
##   feature_names, feature_types, filter(), formula(), groups, hash,
##   head(), id, levels(), measures, missings(), ncol, negative,
##   nrow, positive, properties, rbind(), replace_features(),
##   row_ids, row_roles, select(), set_col_role(), set_row_role(),
##   target_names, task_type, truth(), weights</code></pre>
</div>
<div id="task-api" class="section level3">
<h3><span class="header-section-number">3.1.4</span> Task API</h3>
<p>The task properties and characteristics can be queried using the task’s public member values and methods (see <a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Task</code></a>).
Most of them should be self-explanatory, e.g.,</p>
<pre class="sourceCode r"><code class="sourceCode r">task_iris =<span class="st"> </span>mlr_tasks<span class="op">$</span><span class="kw">get</span>(<span class="st">&quot;iris&quot;</span>)

<span class="co"># public member values</span>
task_iris<span class="op">$</span>nrow</code></pre>
<pre><code>## [1] 150</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">task_iris<span class="op">$</span>ncol</code></pre>
<pre><code>## [1] 5</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># public member methods</span>
task_iris<span class="op">$</span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">3</span>)</code></pre>
<pre><code>##    Species Petal.Length Petal.Width Sepal.Length Sepal.Width
## 1:  setosa          1.4         0.2          5.1         3.5
## 2:  setosa          1.4         0.2          4.9         3.0
## 3:  setosa          1.3         0.2          4.7         3.2</code></pre>
<div id="retrieve-data" class="section level4">
<h4><span class="header-section-number">3.1.4.1</span> Retrieve Data</h4>
<p>In <code>mlr3</code>, each row (observation) has a unique identifier which can be either <code>integer()</code> or <code>character()</code>.
These can be used to select specific rows.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># iris uses integer row_ids</span>
<span class="kw">head</span>(task_iris<span class="op">$</span>row_ids)</code></pre>
<pre><code>## [1] 1 2 3 4 5 6</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># retrieve data for rows with ids 1, 51, and 101</span>
task_iris<span class="op">$</span><span class="kw">data</span>(<span class="dt">rows =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">51</span>, <span class="dv">101</span>))</code></pre>
<pre><code>##       Species Petal.Length Petal.Width Sepal.Length Sepal.Width
## 1:     setosa          1.4         0.2          5.1         3.5
## 2: versicolor          4.7         1.4          7.0         3.2
## 3:  virginica          6.0         2.5          6.3         3.3</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># mtcars uses the rownames of the original data set</span>
<span class="kw">head</span>(task_mtcars<span class="op">$</span>row_ids)</code></pre>
<pre><code>## [1] &quot;AMC Javelin&quot;        &quot;Cadillac Fleetwood&quot; &quot;Camaro Z28&quot;        
## [4] &quot;Chrysler Imperial&quot;  &quot;Datsun 710&quot;         &quot;Dodge Challenger&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># retrieve data for rows with id &quot;Datsun 710&quot;</span>
task_mtcars<span class="op">$</span><span class="kw">data</span>(<span class="dt">rows =</span> <span class="st">&quot;Datsun 710&quot;</span>)</code></pre>
<pre><code>##     mpg cyl disp
## 1: 22.8   4  108</code></pre>
<p>Note that the method <code>$data()</code> is only an accessor and does not modify the underlying data/task.</p>
<p>Analogously, each column has an identifier, which is often just called column name.
These are stored in the public fields <code>feature_names</code> and <code>target_names</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">task_iris<span class="op">$</span>feature_names</code></pre>
<pre><code>## [1] &quot;Petal.Length&quot; &quot;Petal.Width&quot;  &quot;Sepal.Length&quot; &quot;Sepal.Width&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">task_iris<span class="op">$</span>target_names</code></pre>
<pre><code>## [1] &quot;Species&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># retrieve data for rows 1, 51, and 101 and only select column &quot;Species&quot;</span>
task_iris<span class="op">$</span><span class="kw">data</span>(<span class="dt">rows =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">51</span>, <span class="dv">101</span>), <span class="dt">cols =</span> <span class="st">&quot;Species&quot;</span>)</code></pre>
<pre><code>##       Species
## 1:     setosa
## 2: versicolor
## 3:  virginica</code></pre>
<p>To retrieve the complete data set, e.g. for a closer inspection, convert to a <code>data.table()</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(<span class="kw">as.data.table</span>(task_iris))</code></pre>
<pre><code>##        Species    Petal.Length    Petal.Width     Sepal.Length  
##  setosa    :50   Min.   :1.000   Min.   :0.100   Min.   :4.300  
##  versicolor:50   1st Qu.:1.600   1st Qu.:0.300   1st Qu.:5.100  
##  virginica :50   Median :4.350   Median :1.300   Median :5.800  
##                  Mean   :3.758   Mean   :1.199   Mean   :5.843  
##                  3rd Qu.:5.100   3rd Qu.:1.800   3rd Qu.:6.400  
##                  Max.   :6.900   Max.   :2.500   Max.   :7.900  
##   Sepal.Width   
##  Min.   :2.000  
##  1st Qu.:2.800  
##  Median :3.000  
##  Mean   :3.057  
##  3rd Qu.:3.300  
##  Max.   :4.400</code></pre>
</div>
<div id="roles" class="section level4">
<h4><span class="header-section-number">3.1.4.2</span> Roles</h4>
<p>It is possible to assign special roles to (subsets of) rows and columns.</p>
<p>For example, the previously constructed mtcars task has the following column roles:</p>
<pre class="sourceCode r"><code class="sourceCode r">task_mtcars<span class="op">$</span>col_roles</code></pre>
<pre><code>## $feature
## [1] &quot;cyl&quot;  &quot;disp&quot;
## 
## $target
## [1] &quot;mpg&quot;
## 
## $label
## character(0)
## 
## $order
## character(0)
## 
## $groups
## character(0)
## 
## $weights
## character(0)</code></pre>
<p>Now, we want the original <code>rownames()</code> of <code>mtcars</code> to be a regular feature column.
Thus, we first pre-process the <code>data.frame</code> and then re-create the task.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;data.table&quot;</span>)
<span class="co"># with `keep.rownames`, data.table stores the row names in an extra column &quot;rn&quot;</span>
data =<span class="st"> </span><span class="kw">as.data.table</span>(mtcars[, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dt">keep.rownames =</span> <span class="ot">TRUE</span>)
task =<span class="st"> </span>TaskRegr<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">&quot;cars&quot;</span>, <span class="dt">backend =</span> data, <span class="dt">target =</span> <span class="st">&quot;mpg&quot;</span>)

<span class="co"># we now have integer row_ids</span>
task<span class="op">$</span>row_ids</code></pre>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
## [24] 24 25 26 27 28 29 30 31 32</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># there is a new &quot;feature&quot; called &quot;rn&quot;</span>
task<span class="op">$</span>feature_names</code></pre>
<pre><code>## [1] &quot;cyl&quot;  &quot;disp&quot; &quot;rn&quot;</code></pre>
<p>The column “rn” is now a regular feature.
As this is a unique string column, most machine learning algorithms will have problems to process this feature without some kind of preprocessing.
However, we still might want to carry <code>rn</code> around for different reasons.
E.g., we can use the row names in plots or to associate outliers with the row names.
This being said, we need to change the role of the row names column <code>rn</code> and remove it from the set of active features.</p>
<pre class="sourceCode r"><code class="sourceCode r">task<span class="op">$</span>feature_names</code></pre>
<pre><code>## [1] &quot;cyl&quot;  &quot;disp&quot; &quot;rn&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">task<span class="op">$</span><span class="kw">set_col_role</span>(<span class="st">&quot;rn&quot;</span>, <span class="dt">new_roles =</span> <span class="st">&quot;label&quot;</span>)

<span class="co"># &quot;rn&quot; not listed as feature any more</span>
task<span class="op">$</span>feature_names</code></pre>
<pre><code>## [1] &quot;cyl&quot;  &quot;disp&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># also vanished from &quot;data&quot; and &quot;head&quot;</span>
task<span class="op">$</span><span class="kw">data</span>(<span class="dt">rows =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</code></pre>
<pre><code>##    mpg cyl disp
## 1:  21   6  160
## 2:  21   6  160</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">task<span class="op">$</span><span class="kw">head</span>(<span class="dv">2</span>)</code></pre>
<pre><code>##    mpg cyl disp
## 1:  21   6  160
## 2:  21   6  160</code></pre>
<p>Note that no copies of the underlying data is inflicted by this operation.
By changing roles, only the view on the data is changed, not the data itself.</p>
<p>Just like columns, it is also possible to assign different roles to rows.
Rows can have two different roles:</p>
<ol style="list-style-type: decimal">
<li>Role <code>"use"</code>:
Rows that are generally available for model fitting (although they may also be used as test set in resampling).
This is the default role.</li>
<li>Role <code>"validation"</code>:
Rows that are held back (see below).
Rows which have missing values in the target column upon task creation are automatically moved to the validation set.</li>
</ol>
<p>There are several reasons to hold some observations back or treat them differently:</p>
<ol style="list-style-type: decimal">
<li>It is often good practice to validate the final model on an external validation set to uncover possible overfitting</li>
<li>Some observations may be unlabeled, e.g. in data mining cups or <a href="https://www.kaggle.com/">Kaggle</a> competitions.
These observations cannot be used for training a model, but you can still predict labels.</li>
</ol>
</div>
<div id="task-mutators" class="section level4">
<h4><span class="header-section-number">3.1.4.3</span> Task Mutators</h4>
<p>The methods <code>set_col_role()</code> and <code>set_row_role()</code> change the view on the data and can be used to subset the task.
For convenience, the method <code>filter()</code> subsets the task based on row ids, and <code>select()</code> subsets the task based on feature names.
All these operations only change the view on the data, without creating a copy of it, but modify the task in-place.</p>
<pre class="sourceCode r"><code class="sourceCode r">task =<span class="st"> </span>mlr_tasks<span class="op">$</span><span class="kw">get</span>(<span class="st">&quot;iris&quot;</span>)
task<span class="op">$</span><span class="kw">select</span>(<span class="kw">c</span>(<span class="st">&quot;Sepal.Width&quot;</span>, <span class="st">&quot;Sepal.Length&quot;</span>)) <span class="co"># keep only these features</span>
task<span class="op">$</span><span class="kw">filter</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) <span class="co"># keep only these rows</span>
task<span class="op">$</span><span class="kw">head</span>()</code></pre>
<pre><code>##    Species Sepal.Length Sepal.Width
## 1:  setosa          5.1         3.5
## 2:  setosa          4.9         3.0
## 3:  setosa          4.7         3.2</code></pre>
<p>Additionally, the methods <code>rbind()</code> and <code>cbind()</code> allow to add extra rows and columns to a task, respectively.
The method <code>replace_features()</code> is a convenience wrapper around <code>select()</code> and <code>cbind()</code>.
Again, the original data set stored in the original <code>mlr3::DataBackend</code> is not altered in any way.</p>
<pre class="sourceCode r"><code class="sourceCode r">task<span class="op">$</span><span class="kw">cbind</span>(<span class="kw">data.table</span>(<span class="dt">foo =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])) <span class="co"># add column foo</span>
task<span class="op">$</span><span class="kw">head</span>()</code></pre>
<pre><code>##    Species Sepal.Length Sepal.Width foo
## 1:  setosa          5.1         3.5   a
## 2:  setosa          4.9         3.0   b
## 3:  setosa          4.7         3.2   c</code></pre>
</div>
</div>
</div>
<div id="learners" class="section level2">
<h2><span class="header-section-number">3.2</span> Learners</h2>
<p>Objects of class <code>mlr3::Learner</code> provide a unified interface to many popular machine learning algorithms in R.
They consist of methods to train and predict on a <code>mlr3::Task</code>, and additionally provide meta information about the algorithms.</p>
<p>The package ships with only a rather minimal set of classification and regression learners, more are implemented in the <a href="https://mlr3learners.mlr-org.com">mlr3learners</a> package.
Furthermore, <a href="https://mlr3learners.mlr-org.com">mlr3learners</a> has some documentation on creating custom learners.</p>
<div id="predefined-learners" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Predefined Learners</h3>
<p>Analogously to <code>mlr3::mlr_tasks</code>, the <code>mlr3::Dictionary</code> <code>mlr3::mlr_learners</code> can be queried for available learners:</p>
<pre class="sourceCode r"><code class="sourceCode r">mlr_learners</code></pre>
<pre><code>## &lt;DictionaryLearner&gt; with 5 stored values
## Keys: classif.debug, classif.featureless, classif.rpart,
##   regr.featureless, regr.rpart
## 
## Public: add(), get(), has(), items, keys(), mget(), remove()</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.data.table</span>(mlr_learners)</code></pre>
<pre><code>##                    key                                    feature_types
## 1:       classif.debug logical,integer,numeric,character,factor,ordered
## 2: classif.featureless logical,integer,numeric,character,factor,ordered
## 3:       classif.rpart logical,integer,numeric,character,factor,ordered
## 4:    regr.featureless logical,integer,numeric,character,factor,ordered
## 5:          regr.rpart logical,integer,numeric,character,factor,ordered
##    packages
## 1:         
## 2:         
## 3:    rpart
## 4:         
## 5:    rpart
##                                                           properties
## 1:                                                          missings
## 2:         importance,missings,multiclass,selected_features,twoclass
## 3: importance,missings,multiclass,selected_features,twoclass,weights
## 4:                             importance,missings,selected_features
## 5:                     importance,missings,selected_features,weights
##    predict_types
## 1: response,prob
## 2: response,prob
## 3: response,prob
## 4:   response,se
## 5:      response</code></pre>
<p>As listed in the output, each learner comes with the following annotations:</p>
<ul>
<li><code>feature_types</code>: what kind of features can be processed.</li>
<li><code>packages</code>: which packages are required to run <code>train()</code> and <code>predict()</code>.</li>
<li><code>properties</code>: additional properties and capabilities. E.g., a learner has the property “missings” if it is able to
handle missing values natively, and “importance” if it is possible to extract feature importance values.</li>
<li><code>predict_types</code>: what predict types are possible. E.g., a classification learner can predict labels (“response”) or probabilities (“prob”)</li>
</ul>
<p>To extract a specific learner, use the corresponding “id”:</p>
<pre class="sourceCode r"><code class="sourceCode r">learner =<span class="st"> </span>mlr_learners<span class="op">$</span><span class="kw">get</span>(<span class="st">&quot;classif.rpart&quot;</span>)
learner</code></pre>
<pre><code>## &lt;LearnerClassifRpart:classif.rpart&gt;
## Parameters: list()
## Packages: rpart
## Predict Type: response
## Feature types: logical, integer, numeric, character, factor,
##   ordered
## Properties: importance, missings, multiclass, selected_features,
##   twoclass, weights
## 
## Public: clone(), data_formats, fallback, feature_types, hash, id,
##   importance(), model, packages, param_set, params(),
##   predict_type, predict_types, predict(), properties,
##   selected_features(), task_type, train()</code></pre>
<p>As the printer shows, all information from the previous table is also accessible via public fields (<code>id</code>, <code>feature_types</code>, <code>packages</code>, <code>properties</code>, <code>predict_types</code>)
Additionally, <code>predict_type</code> returns the currently selected predict type of the learner.</p>
<p>The field <code>param_set</code> stores a description of hyperparameter settings:</p>
<pre class="sourceCode r"><code class="sourceCode r">learner<span class="op">$</span>param_set</code></pre>
<pre><code>## ParamSet: paramset
##              id    class lower upper levels default value
## 1:     minsplit ParamInt     1   Inf             20      
## 2:           cp ParamDbl     0     1           0.01      
## 3:   maxcompete ParamInt     0   Inf              4      
## 4: maxsurrogate ParamInt     0   Inf              5      
## 5:     maxdepth ParamInt     1    30             30      
## 6:         xval ParamInt     0   Inf             10</code></pre>
<p>The set of hyperparamter values is stored inside the parameter set in the field <code>values</code>.
By assigning a named list to this field, we change the active hyperparameters of the learner:</p>
<pre class="sourceCode r"><code class="sourceCode r">learner<span class="op">$</span>param_set<span class="op">$</span>values =<span class="st"> </span><span class="kw">list</span>(<span class="dt">cp =</span> <span class="fl">0.01</span>)
learner</code></pre>
<pre><code>## &lt;LearnerClassifRpart:classif.rpart&gt;
## Parameters: cp=0.01
## Packages: rpart
## Predict Type: response
## Feature types: logical, integer, numeric, character, factor,
##   ordered
## Properties: importance, missings, multiclass, selected_features,
##   twoclass, weights
## 
## Public: clone(), data_formats, fallback, feature_types, hash, id,
##   importance(), model, packages, param_set, params(),
##   predict_type, predict_types, predict(), properties,
##   selected_features(), task_type, train()</code></pre>
<p>The field <code>model</code> stores the result of the training step.
As we have not yet learned a model, this is <code>NULL</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">learner<span class="op">$</span>model</code></pre>
<pre><code>## NULL</code></pre>
</div>
<div id="train-and-predict" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Train and Predict</h3>
<p>Is recommended to train the learner via the <code>mlr3::Experiment</code> class, we only train the learner here directly to showcase more of its API.</p>
<p>First, we retrieve the “iris” task from the <code>mlr3::mlr_tasks</code> dictionary, and then apply the train method on the complete task.</p>
<pre class="sourceCode r"><code class="sourceCode r">task =<span class="st"> </span>mlr_tasks<span class="op">$</span><span class="kw">get</span>(<span class="st">&quot;iris&quot;</span>)
learner<span class="op">$</span><span class="kw">train</span>(task)</code></pre>
<pre><code>## &lt;LearnerClassifRpart:classif.rpart&gt;
## Parameters: cp=0.01
## Packages: rpart
## Predict Type: response
## Feature types: logical, integer, numeric, character, factor,
##   ordered
## Properties: importance, missings, multiclass, selected_features,
##   twoclass, weights
## 
## Public: clone(), data_formats, fallback, feature_types, hash, id,
##   importance(), model, packages, param_set, params(),
##   predict_type, predict_types, predict(), properties,
##   selected_features(), task_type, train()</code></pre>
<p>The learner returns itself, the fitted model is stored in the field “model”:</p>
<pre class="sourceCode r"><code class="sourceCode r">learner<span class="op">$</span>model</code></pre>
<pre><code>## n= 150 
## 
## node), split, n, loss, yval, (yprob)
##       * denotes terminal node
## 
## 1) root 150 100 setosa (0.33333333 0.33333333 0.33333333)  
##   2) Petal.Length&lt; 2.45 50   0 setosa (1.00000000 0.00000000 0.00000000) *
##   3) Petal.Length&gt;=2.45 100  50 versicolor (0.00000000 0.50000000 0.50000000)  
##     6) Petal.Width&lt; 1.75 54   5 versicolor (0.00000000 0.90740741 0.09259259) *
##     7) Petal.Width&gt;=1.75 46   1 virginica (0.00000000 0.02173913 0.97826087) *</code></pre>
<p>Next, we generate predictions on the complete iris data set:</p>
<pre class="sourceCode r"><code class="sourceCode r">predictions =<span class="st"> </span>learner<span class="op">$</span><span class="kw">predict</span>(task)</code></pre>
<p>The returned <code>mlr3::PredictionClassif</code> object stores the predicted labels (“response”) as well as the true labels (“truth”).</p>
<p>By simply counting the number of correct predictions and dividing by the number of observations, we can calculate the accuracy:</p>
<pre class="sourceCode r"><code class="sourceCode r">tab =<span class="st"> </span><span class="kw">as.data.table</span>(predictions)
<span class="kw">mean</span>(tab<span class="op">$</span>response <span class="op">==</span><span class="st"> </span>tab<span class="op">$</span>truth)</code></pre>
<pre><code>## [1] 0.96</code></pre>
<p>Note that this measure is over-optimistic.
As we did not used an independent test set, this is the re-substitution error.</p>
</div>
</div>
<div id="measures" class="section level2">
<h2><span class="header-section-number">3.3</span> Performance Measures</h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="experiments.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["mlr3book.pdf", "mlr3book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
